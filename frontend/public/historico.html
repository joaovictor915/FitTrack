<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hist√≥rico de Atividades FitTrack</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="nav-placeholder"></div>
    <script>
        fetch('nav-bar.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('nav-placeholder').innerHTML = data;
            });
    </script>
    <div class="container" style="max-width: 800px;">
        <div class="header-section" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px; flex-wrap: wrap; gap: 15px;">
            <div>
                <h2 style="margin:0; font-size:2.2em; font-weight: 700;">üìã Hist√≥rico de Atividades</h2>
                <p style="margin: 8px 0 0 0; color: var(--text-medium); font-size: 0.95em;">Visualize e gerencie todas as suas atividades</p>
            </div>
            <a href="dashboard.html" style="text-decoration: none; color: var(--primary-color); font-weight: 600; font-size:1em; padding: 8px 16px; border: 1.5px solid var(--primary-color); border-radius: 8px; transition: all 0.3s ease;">
                ‚Üê Voltar
            </a>
        </div>
        <div id="historicoList">
            <div class="activity-item corrida" data-activity-id="1" style="margin-bottom:18px;">
                <div class="activity-title">Corrida</div>
                <div class="activity-details">Dura√ß√£o: 45 min | Dist√¢ncia: 5.2 km</div>
                <span class="activity-date">01 de Outubro de 2025</span>
            </div>
            <div class="activity-item caminhada" data-activity-id="2" style="margin-bottom:18px;">
                <div class="activity-title">Caminhada</div>
                <div class="activity-details">Dura√ß√£o: 60 min | Dist√¢ncia: 3.5 km</div>
                <span class="activity-date">28 de Setembro de 2025</span>
            </div>
            <div class="activity-item musculacao" data-activity-id="3" style="margin-bottom:18px;">
                <div class="activity-title">Muscula√ß√£o</div>
                <div class="activity-details">Dura√ß√£o: 80 min | Calorias Estimadas: 500 kcal</div>
                <span class="activity-date">25 de Setembro de 2025</span>
            </div>
            <div class="activity-item yoga" data-activity-id="4">
                <div class="activity-title">Yoga (RF006)</div>
                <div class="activity-details">Dura√ß√£o: 40 min</div>
                <span class="activity-date">20 de Setembro de 2025</span>
            </div>
        </div>
        <p style="text-align: center; margin-top: 30px; font-size: 0.97em; color: var(--text-light);">
            Clique em um registro para Editar ou Excluir.
        </p>
    </div>
    <script src="src/api/APIClient.js"></script>
    <script src="src/controllers/Controllers.js"></script>
    <script src="src/utils/Utilidades.js"></script>
    <script>
    async function carregarAtividades() {
        try {
            const autenticado = await authController.inicializar();
            if (!autenticado) {
                window.location.href = 'login.html';
                return;
            }
            const resultado = await atividadesController.listar();
            const historicoList = document.getElementById('historicoList');
            historicoList.innerHTML = '';
            if (resultado.atividades.length === 0) {
                historicoList.innerHTML = '<p style="text-align: center; color: #999;">Nenhuma atividade registrada</p>';
                return;
            }
            resultado.atividades.forEach(atividade => {
                const item = document.createElement('div');
                item.className = `activity-item ${atividade.tipo}`;
                item.style.marginBottom = '18px';
                item.dataset.activityId = atividade.id;
                item.innerHTML = `
                    <div class="activity-title">${util.formatarTipoAtividade(atividade.tipo)}</div>
                    <div class="activity-details">
                        ${atividade.duracao ? `Dura√ß√£o: ${atividade.duracao} min` : ''}
                        ${atividade.distancia ? `| Dist√¢ncia: ${util.formatarNumero(atividade.distancia, 2)} km` : ''}
                        ${atividade.calorias_queimadas ? `| Calorias: ${util.formatarNumero(atividade.calorias_queimadas)} kcal` : ''}
                    </div>
                    <span class="activity-date">${util.formatarData(atividade.data_atividade)}</span>
                    <div style="margin-top: 15px; display: flex; gap: 12px; justify-content: flex-end;">
                        <button class="btn-editar" onclick="editarAtividade(${atividade.id})" style="width: auto; padding: 10px 20px; font-size: 0.9em;">‚úèÔ∏è Editar</button>
                        <button class="btn-deletar" onclick="deletarAtividade(${atividade.id})" style="width: auto; padding: 10px 20px; font-size: 0.9em;">üóëÔ∏è Deletar</button>
                    </div>
                `;
                historicoList.appendChild(item);
            });
        } catch (erro) {
            document.getElementById('historicoList').innerHTML = '<p style="color: red;">Erro ao carregar atividades</p>';
        }
    }
    
    async function editarAtividade(id) {
        window.location.href = `editar_atividade.html?id=${id}`;
    }

    async function deletarAtividade(id) {
        if (!util.confirmar('Tem certeza que deseja deletar esta atividade?')) {
            return;
        }

        try {
            await atividadesController.deletar(id);
            util.mostrarSucesso('Atividade deletada com sucesso!');
            carregarAtividades();
        } catch (erro) {
            util.mostrarErro(erro.message || 'Erro ao deletar atividade');
        }
    }

    document.querySelector('a[href="dashboard.html"]').addEventListener('click', (e) => {
        e.preventDefault();
        window.location.href = 'dashboard.html';
    });
    window.addEventListener('load', carregarAtividades);
    </script>
</body>
</html>